% ----------------------------------------------------------------------------
\chapter{Implementation of the Prototype}

5. Technical documentation and prototype for the new chat system

% ----------------------------------------------------------------------------
\section{Various imported}
% ----------------------------------------------------------------------------

Different programs handle different objectives
\subsubsection{Additional constraints}
Cross-OS. Posix and/or ansi-c. ui changable.
\subsection{Intra Machine Intra Program Protocol}
\subsubsection{Interfaces}
Sockets, Environment, Paths, etc.
\subsubsection{Data Types}
\subsubsection{Sub Programs}
Consists of the following sub-programs:
encryption, dictionary, key/peer exchange daemon (if possible in this work),
% ----------------------------------------------------------------------------
\subsection{Sub Programs}
Describe what it does, how it does and where it is implemented.
\subsubsection{Noise / Dictionary / Database}
Generate input for times when there is no user input.
Random or db or or or.
Networt traffic
\subsubsection{Encryption}
Splitting of encryption into a seperate program can make use of
multiple computing ressources.
\subsubsection{User Interface}
Own program, indepentend of core.
\subsubsection{Transports}
Receive/Send


% ----------------------------------------------------------------------------
\section{Requirements implementation}
Based on the requirements defined in \ref{requirements}, 
p. \pageref{requirements}, the following features have been implemented. 
% MIRROR of that chapter here!

% ----------------------------------------------------------------------------
\subsection{Anonymity}
Multi-Hop onion routingg

Sender verification
Before the encrypt the packet, it is signed via public-key
cryptography\cite{pgp-1}. Thus only the receiver can verify the message sender.

\subsubsection{obfuscation}
- Hide message sending 

We don't think it's possible to hide that you are part of the chat network,
because some heuristics will be developed to detect the chat packets.
So we use a different idea:
Every participant of an EOF network will constantly send chat packets
with a pre-defined frequency (for instance every 250 ms). 
If you don't chat, \emph{noise} is sent.\footnote{Noise is just random
data, see below for a more detailled description of noise.}
The noise is also used to defend against timing analysis.
In case you are sending out a message, the message packet will be added to the
queue and sent within the next free time slot.

From outside it can easily be seen, that you are part of the network,
but not, if you sent a message.

\subsubsection{Hide message receiver}
The message packets are always sent indirectly via onion routing\cite{onion-1}.
The idea is taken from the Tor project\cite{tor-1}, though EOF uses an enhanced
version: EOF does not know about entry or exit nodes. If you are the intended
receiver you may or may not continue to forward the message, which is defined
by the sender of the message. That said, EOF must use source 
routing\cite{source-routing-1}.

To support onion routing, the sender of a packet needs to encrypt the packet
multiple times, once for each host that receives the packet. This may look
as follows:
\begin{enumerate}
\item Create message (from noise or user input)
\item Create source path
\item Create packet for last peer ("`pkg-last"')
\item Create packet for last-1 peer including \emph{pkg-last}
\item Continue until first peer is reached
\item Sent packet to first peer 
\end{enumerate}
Thus every peer only knows the previous and the next peer.
% Nico: 1.0


\subsection{Availability}
To prevent
successful elimination of the service, a decentralised architecture should


\subsubsection{Reliable against single user attacks}
Traditional chat networks depend on one or more central organised servers.
An attacker can stop all communication, if she runs a successful denial
of service ("`DoS"') attack against the central systems.
To protect against this, EOF uses a dynamic peer-to-peer network, which works
as long as the minimun number of peers and the destination peer is available.
It has no dependency on a central server.

\subsubsection{Hide packets in network stream}
As said before, we don't think it's possible to hide the participation in the
chat network. To be able to send packets, although an attacker \emph{knows}
about the participation, EOF embeds all chat packets into other (well known)
protocols (which is knows as steganography\cite{stegano-1}).
EOF does not implement nor specify \emph{transport protocols} itself.
The EOF community is urged to implement them in a creative way: Usage
of well-known protocols like TCP\cite{tcp-1}, HTTP\cite{http-1},
SMTP\cite{smtp-1} or even transmission of packets on avian
carriers\cite{avian-1} are encouraged. The tunneling of EOF packets through
those protocols (also know as obfuscation) makes it harder to detect
and \emph{block} EOF traffic. 
If an attacker wants you to stop sending messages, she has to completly
remove you from the network, because any open protocol may be (ab)used to
encapsulate EOF packets into it.
% Nico: 1.0 




\subsection{Confidentiality}

\subsection{Integrity}
Before the encrypt the packet, it is signed via public-key
cryptography\cite{pgp-1}. Thus only the receiver can verify the message sender.


% ----------------------------------------------------------------------------
\section{Modular Design}
UI seperated.
Portable Core.
% ----------------------------------------------------------------------------
\subsection{Noise Engine}
To generate noise, all files from a specific directory are read.
Should be UTF-8 encoded files.

\begin{verbatim}
% cd ~/.ceof 
% mkdir noise
% cd noise 
# Linux Kernel is a good source for noise
% find ~/p/linux/linus -name '*.c' -type f -exec ln -fs {} \;
# Add some rfcs to the noise soup
% find ~/oeffentlich/rechner/netz/rfc/mirror/rfcs-text-only/ -name '*.txt' -type f -exec ln -fs {} \;
% ls | wc -l
23287
\end{verbatim}

% ----------------------------------------------------------------------------
This section describes the actual implementation
Python?
\section{Non-Cross OS Support}
Support for different OS would have made development more
hard, so support for POSIX alike operating systems was targeted.

\section{Python and GPG}
Various implementations \cite{python-gpg}
PyMe: 3 Nachrichten in 2010
\url{http://sourceforge.net/mailarchive/forum.php?forum_name=pyme-help&style=threaded}

python-gnupg commits in september 2011 \cite{python-gnupg}

Selected python-gnupg

\subsection{Configuration}
The configuration of EOFi is stored in the cconfig\cite{cconfig} format.
% Nico: FIXME for 1.0: cite


% ----------------------------------------------------------------------------
\section{Performance}
\subsection{Packet size}
Re-testing of crypt (using test/recrypt): 5.2 - 5.3 KiB per packet.

\subsection{Bandwidth usage}
After protocol overhead...

% ----------------------------------------------------------------------------
\section{Usage}

% ----------------------------------------------------------------------------
\subsection{Preperation}
\begin{verbatim}
% virtualenv python-env
% . ./python-env/bin/activate
% pip install python-gnupg
% (cd python-env/bin && ln -s python python3)
\end{verbatim}

