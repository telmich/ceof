% ----------------------------------------------------------------------------
\chapter{Implementation of the Prototype}
% 5. Technical documentation and prototype for the new chat system
% ----------------------------------------------------------------------------
\section{Usage}
How to use.
% ----------------------------------------------------------------------------
\section{Development Process}
spiral
% ----------------------------------------------------------------------------
\section{Environment}
% ----------------------------------------------------------------------------
\subsection{Preperation}
\begin{verbatim}
% virtualenv python-env
% . ./python-env/bin/activate
% pip install python-gnupg
% (cd python-env/bin && ln -s python python3)
\end{verbatim}
python gnupg, virtualenv
Cross-OS. Posix and/or ansi-c. ui changable.
Sockets, Environment, Paths, etc.
Support for different OS would have made development more
hard, so support for POSIX alike operating systems was targeted.

\section{Python and GPG}
Various implementations \cite{python-gpg}
PyMe: 3 Nachrichten in 2010
\url{http://sourceforge.net/mailarchive/forum.php?forum_name=pyme-help&style=threaded}

python-gnupg commits in september 2011 \cite{python-gnupg}

Selected python-gnupg

\subsection{Configuration}
The configuration of EOFi is stored in the cconfig\cite{cconfig} format.
% Nico: FIXME for 1.0: cite

% ----------------------------------------------------------------------------
\section{Related Project: Chat UI}
Own program, indepentend of core, side project
% ----------------------------------------------------------------------------
\section{Code Examples}
% ----------------------------------------------------------------------------
\subsection{Modular Design}
UI seperated.
Portable Core.
id, base 64, 
queuing
forks
manual poll

noise

\subsubsection{Sub Programs}
Consists of the following sub-programs:
encryption, dictionary, key/peer exchange daemon (if possible in this work),
modular design
Different programs handle different objectives

\subsection{Encryption}
Splitting of encryption into a seperate program can make use of
multiple computing ressources.
% ----------------------------------------------------------------------------
\subsection{Noise Engine}
To generate noise, all files from a specific directory are read.
Should be UTF-8 encoded files.

\begin{verbatim}
% cd ~/.ceof 
% mkdir noise
% cd noise 
# Linux Kernel is a good source for noise
% find ~/p/linux/linus -name '*.c' -type f -exec ln -fs {} \;
# Add some rfcs to the noise soup
% find ~/oeffentlich/rechner/netz/rfc/mirror/rfcs-text-only/ -name '*.txt' -type f -exec ln -fs {} \;
% ls | wc -l
23287
\end{verbatim}

Generate input for times when there is no user input.
Random or db or or or.
Networt traffic

\subsection{Transport protocols}
% ----------------------------------------------------------------------------
\section{Command Line Options}

% ----------------------------------------------------------------------------
\section{Test of the Prototype}
%    6. Description of test results


% ----------------------------------------------------------------------------
\subsection{Performance}
%\subsection{Packet size}
Re-testing of crypt (using test/recrypt): 5.2 - 5.3 KiB per packet.

\subsection{Bandwidth usage}
After protocol overhead...

% ----------------------------------------------------------------------------


% ----------------------------------------------------------------------------
\section{Supported Features}
Based on the requirements defined in \ref{requirements}, 
p. \pageref{requirements}, the following features have been implemented. 
% MIRROR of that chapter here!

% ----------------------------------------------------------------------------
\subsection{Anonymity}
Multi-Hop onion routingg

Sender verification
Before the encrypt the packet, it is signed via public-key
cryptography\cite{pgp-1}. Thus only the receiver can verify the message sender.

\subsubsection{obfuscation}
- Hide message sending 

We don't think it's possible to hide that you are part of the chat network,
because some heuristics will be developed to detect the chat packets.
So we use a different idea:
Every participant of an EOF network will constantly send chat packets
with a pre-defined frequency (for instance every 250 ms). 
If you don't chat, \emph{noise} is sent.\footnote{Noise is just random
data, see below for a more detailled description of noise.}
The noise is also used to defend against timing analysis.
In case you are sending out a message, the message packet will be added to the
queue and sent within the next free time slot.

From outside it can easily be seen, that you are part of the network,
but not, if you sent a message.

\subsubsection{Hide message receiver}
The message packets are always sent indirectly via onion routing\cite{onion-1}.
The idea is taken from the Tor project\cite{tor-1}, though EOF uses an enhanced
version: EOF does not know about entry or exit nodes. If you are the intended
receiver you may or may not continue to forward the message, which is defined
by the sender of the message. That said, EOF must use source 
routing\cite{source-routing-1}.

To support onion routing, the sender of a packet needs to encrypt the packet
multiple times, once for each host that receives the packet. This may look
as follows:
\begin{enumerate}
\item Create message (from noise or user input)
\item Create source path
\item Create packet for last peer ("`pkg-last"')
\item Create packet for last-1 peer including \emph{pkg-last}
\item Continue until first peer is reached
\item Sent packet to first peer 
\end{enumerate}
Thus every peer only knows the previous and the next peer.
% Nico: 1.0


\subsection{Availability}
To prevent
successful elimination of the service, a decentralised architecture should


\subsubsection{Reliable against single user attacks}
Traditional chat networks depend on one or more central organised servers.
An attacker can stop all communication, if she runs a successful denial
of service ("`DoS"') attack against the central systems.
To protect against this, EOF uses a dynamic peer-to-peer network, which works
as long as the minimun number of peers and the destination peer is available.
It has no dependency on a central server.

\subsubsection{Hide packets in network stream}
As said before, we don't think it's possible to hide the participation in the
chat network. To be able to send packets, although an attacker \emph{knows}
about the participation, EOF embeds all chat packets into other (well known)
protocols (which is knows as steganography\cite{stegano-1}).
EOF does not implement nor specify \emph{transport protocols} itself.
The EOF community is urged to implement them in a creative way: Usage
of well-known protocols like TCP\cite{tcp-1}, HTTP\cite{http-1},
SMTP\cite{smtp-1} or even transmission of packets on avian
carriers\cite{avian-1} are encouraged. The tunneling of EOF packets through
those protocols (also know as obfuscation) makes it harder to detect
and \emph{block} EOF traffic. 
If an attacker wants you to stop sending messages, she has to completly
remove you from the network, because any open protocol may be (ab)used to
encapsulate EOF packets into it.
% Nico: 1.0 




\subsection{Confidentiality}

\subsection{Integrity}
Before the encrypt the packet, it is signed via public-key
cryptography\cite{pgp-1}. Thus only the receiver can verify the message sender.


% #############################################################################
\section{Transport protocols ("`eofi2tp"')}
\label{eofi2tp}
% -----------------------------------------------------------------------------
\subsection{Definition/Specification}
URL, URI, Scheme clearification, use tcp:// and http:// syntax.


\begin{longtable}{|c|c|}
\caption{Required transport protocols}\\
\hline
\textbf{Scheme} & \textbf{Name}\\
\hline
\verb=available/= & Available transport procols\\
\hline
\verb=available/<scheme>/listen= & Listener (executable) for the scheme\\
\hline
\verb=available/<scheme>/send= & Sender (executable) for the scheme\\
\hline
\verb=listen/= & Enabled listeners\\
\hline
\verb=listen/<freeform>/url= & URL \\
\hline
\end{longtable}
% -----------------------------------------------------------------------------
\subsubsection{Enabling a scheme}
\label{tpscheme}
To enable support for the scheme \verb=http=
create both, the \verb=listen= and the \verb=send= executable below
\verb=available/http=.
% Nico: 1.0
% -----------------------------------------------------------------------------
\subsubsection{Enabling a listener}
\label{tplisten}
To enable a listener for the scheme \emph{http} at the URL
\emph{http://www.example.com/eof}, create
the directory \verb=listen/http-example= and the file
\verb=listen/http-example/url= with the content
\verb=http://www.example.com/eof=.
If the transport protocol implementation needs or allows additional
configuration files, they should be placed in the same directory.
The EOF implementation will parse the URL and check whether the
scheme is supported.
% Nico: 1.0
% -----------------------------------------------------------------------------
\subsection{Required implementations}
\label{tprequired}
This version of the EOF standard requires support for the following
transport protocols in the implementation:
\begin{longtable}{|c|c|c|c|}
\caption{Required transport protocols}\\
\hline
\textbf{Scheme} & \textbf{Name} & \textbf{Format} & \textbf{Description}\\
\hline
tcp & IP/TCP & \verb=tcp:host:port= & Plain tcp\\
\hline
\end{longtable}
% -----------------------------------------------------------------------------
\subsection{Upcoming implementations}
\label{tpupcoming}
The following transport protocol implementations have been proposed,
but are not yet implemented and thus not yet part of the standard:

% -----------------------------------------------------------------------------
\subsection{Developing and integrating implementations}
If you want to create a new transport protocol, create the two
executables as described in \ref{tppaths} and put them in their
scheme directory.
If the implementation works fine and you would like to add it to EOF,
create the directory \verb=tp/<scheme>/<implementation_name>= within
the EOFi source directory and update the following
sections of this document:
\begin{itemize}
\item \ref{tprequired}
\item \ref{tprequired} / new subsubsection for the new scheme
\item \ref{tpupcoming}
\end{itemize}

The name of the subsubsection is the name of the scheme
plus the registered implementation ("`like tcp-c"').
Every such subsubsection must at least contain:
\begin{itemize}
\item Author contact information
\item URL of website
\item Programming language
\end{itemize}
Keep the subsubsections sorted by alphabet.
% Nico: 1.0

